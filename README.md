<!-- #######  YAY, I AM THE SOURCE EDITOR! #########-->
<p># openvpn-socks5<br />Docker image with Openvpn and Socks5 Danted server, for access vpn traffic from proxy server.<br />Using Docker image Alpine:edge<br /></p>
<p>Инструкция для чайника!!!</p>
<p>Исходные данные:<br />Имеем vds/vps с ubuntu 18 ip: 10.10.10.10<br />openvpn конфиг файл с названием vpn1.ovpn<br />На выходе хотим получить:<br />socks5 прокси вида<br />anton:pardon02@10.10.10.10:6001<br />где<br />10.10.10.10 - айпи нашей впс<br />6001 - порт socks5 прокси<br />anton - пользователь прокси<br />pardon02 - пароль к прокси<br />------<br />Установка и настройка:<br />1. Установка Docker на сервер<br />подключаемся к ssh и выполняем на сервере от пользователя root<br />apt-get update &amp;&amp; apt-get install curl git socat -y &amp;&amp; curl -fsSL https://get.docker.com -o get-docker.sh &amp;&amp; sh get-docker.sh<br />команду можно просто вставить в консоль она все сделаем<br />проверяем установился ли докер в консоли<br />docker -v<br />должно появится такое сообщение<br />Docker version 19.03.5, build 633a0ea838<br />если его нет значит что то у вас сервером не так<br />------------------<br />2. Установка docker-compose<br />curl -L "https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose<br />chmod +x /usr/local/bin/docker-compose<br />ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose<br />docker-compose --version<br />копируем и вставляем<br />должны получить вывод<br />docker-compose version 1.24.1, build 4667896b<br />-------------------------<br />3.Запуск docker контейнера с openvpn, dante (socks5 proxy) сервером<br />3.1 копирование файлов нужных для установки<br />mkdir /docker-vpn-proxy &amp;&amp; git clone https://github.com/0dataexpert0/openvpn-socks5.git /docker-vpn-proxy<br />в данном случае мы копируем файлы для установки в новую папку на сервере /docker-vpn-proxy переходим в нее<br />cd /docker-vpn-proxy/<br />дальше нам нужно в этой папке создать или загрузить наш конфиг файл vpn1.ovpn<br />тут как вам проще или через nano или через sftp/scp/ftp<br />3.1 подготовка до запуска, вписываем настройки<br />- файл Dockerfile <br />в этом файле изменяем значения "ARG user=anton ARG password=pardon02" на своего юзера и пользователя, эти данные потом будем использовать для подключения к socks5 прокси<br />- файл start <br />тут меняем значение порта, в нашем случае стоит порт 6001<br />"--publish 0.0.0.0:6001:1080 \" - менять надо в этой строчке<br />также меняем название контейнера<br />строчка"--name=vpn-prox1 \" меняем только название "vpn-prox1" на свое<br />ПРИ ИЗМЕНЕНИИ НАДО НЕ НАРУШИТЬ КОЛИЧЕСТВО ПРОБЕЛОВ И ПРОЧЕЕ, ИЗМЕНЯЕМ ТОЛЬКО ПОРТ 6001 НА СВОЙ!<br />3.3 запуск контейнера командой<br />./start vpn1.ovpn &amp;<br />где файл vpn1.ovpn - конфиг опенвпн что мы создали или загрузили в нашу папку /docker-vpn-proxy<br />---<br />ЗАМЕТКА: для запуска другого контейнера нам понадобится<br />создать новую папку для контейнера<br />mkdir /docker-vpn-proxy &amp;&amp; git clone https://github.com/0dataexpert0/openvpn-socks5.git /docker-vpn-proxy<br />в этой команде поменять /docker-vpn-proxy в двух местах на например /docker-vpn-proxy2<br />и получится<br />mkdir /docker-vpn-proxy2 &amp;&amp; git clone https://github.com/0dataexpert0/openvpn-socks5.git /docker-vpn-proxy2<br />- файл Dockerfile <br />в этом файле изменяем значения "ARG user=anton ARG password=pardon02" на своего юзера и пользователя, эти данные потом будем использовать для подключения к socks5 прокси<br />- файл start <br />тут меняем значение порта, в нашем случае стоит порт порт 6001 уже занят первым конйнером потому используем порт 6002<br />и того получится<br />"--publish 0.0.0.0:6002:1080 \" - менять надо в этой строчке<br />также меняем название контейнера<br />строчка "--name=vpn-prox1 \" меняем только название "vpn-prox1" на свое vpn-prox2<br />и получится<br />"--name=vpn-prox2 \"<br />запуск контейнера командой<br />./start vpn1.ovpn &amp;<br />---<br />проверяем что прокси работает<br />должен отобразиться айпи впн севрера</p>
<p>curl --socks5-hostname 127.0.0.1:6003 http://ifconfig.io</p>
<p>3.4 делаем проброс портов<br />socat TCP-LISTEN:6005,fork TCP:127.0.0.1:6003 &amp;<br />в данной команде порт 6005 это тот порт что мы будем использовать в браузере или программе для соединения с прокси сервером<br />порт 6003 это порт который мы меняли или указывали в файле Dockerfile<br />--------<br /> Если openvpn конфиг у нас с авторизацией<br /> нам надо будет изменить наш файл vpn1.ovpn<br /> изменить или добавить строчку строчку с "auth-user-pass"<br /> на <br />auth-user-pass pass.txt<br /> в файл pass.txt<br /> добавить <br /> user/password<br /> например<br /> anton/pardon02<br /> <br /></p>


ping -I tun0 8.8.8.8
